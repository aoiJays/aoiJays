<!DOCTYPE html>
<html lang="zh">
    <!-- title -->
<!-- keywords -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="BiribiriBird">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="BiribiriBird">
        <meta name="keywords" content="hexo,hexo-theme,hexo-blog,Neworld1111,AoiJays,BiribiriBird">
    <meta name="description" content="">
    <meta name="description" content="Langchain入门   前置工作  API-KEY配置 API调用 Promt 简单应用   组件 Models  LLMs  流式输出   Chat Models Embedding models   Prompts  PromptTemplate FewShotPromptTemplate   Chains  LLMChain SimpleSequentialChain LLMChain（">
<meta property="og:type" content="article">
<meta property="og:title" content="Langchain入门笔记">
<meta property="og:url" content="https://aoijays.top/2024/08/11/langchain-zero/index.html">
<meta property="og:site_name" content="BiribiriBird&#39;s Gallery">
<meta property="og:description" content="Langchain入门   前置工作  API-KEY配置 API调用 Promt 简单应用   组件 Models  LLMs  流式输出   Chat Models Embedding models   Prompts  PromptTemplate FewShotPromptTemplate   Chains  LLMChain SimpleSequentialChain LLMChain（">
<meta property="og:locale">
<meta property="article:published_time" content="2024-08-11T09:04:46.000Z">
<meta property="article:modified_time" content="2024-08-11T09:06:31.287Z">
<meta property="article:author" content="BiribiriBird">
<meta property="article:tag" content="langchain">
<meta name="twitter:card" content="summary">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="icon" href="/assets/favicon.ico">
    <title>Langchain入门笔记 · BiribiriBird&#39;s Gallery</title>
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
    (function (w) {
        'use strict'
        // rel=preload support test
        if (!w.loadCSS) {
            w.loadCSS = function () {}
        }
        // define on the loadCSS obj
        var rp = (loadCSS.relpreload = {})
        // rel=preload feature support test
        // runs once and returns a function for compat purposes
        rp.support = (function () {
            var ret
            try {
                ret = w.document.createElement('link').relList.supports('preload')
            } catch (e) {
                ret = false
            }
            return function () {
                return ret
            }
        })()

        // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
        // then change that media back to its intended value on load
        rp.bindMediaToggle = function (link) {
            // remember existing media attr for ultimate state, or default to 'all'
            var finalMedia = link.media || 'all'

            function enableStylesheet() {
                link.media = finalMedia
            }

            // bind load handlers to enable media
            if (link.addEventListener) {
                link.addEventListener('load', enableStylesheet)
            } else if (link.attachEvent) {
                link.attachEvent('onload', enableStylesheet)
            }

            // Set rel and non-applicable media type to start an async request
            // note: timeout allows this to happen async to let rendering continue in IE
            setTimeout(function () {
                link.rel = 'stylesheet'
                link.media = 'only x'
            })
            // also enable media after 3 seconds,
            // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
            setTimeout(enableStylesheet, 3000)
        }

        // loop through link elements in DOM
        rp.poly = function () {
            // double check this to prevent external calls from running
            if (rp.support()) {
                return
            }
            var links = w.document.getElementsByTagName('link')
            for (var i = 0; i < links.length; i++) {
                var link = links[i]
                // qualify links to those with rel=preload and as=style attrs
                if (
                    link.rel === 'preload' &&
                    link.getAttribute('as') === 'style' &&
                    !link.getAttribute('data-loadcss')
                ) {
                    // prevent rerunning on link
                    link.setAttribute('data-loadcss', true)
                    // bind listeners to toggle media back
                    rp.bindMediaToggle(link)
                }
            }
        }

        // if unsupported, run the polyfill
        if (!rp.support()) {
            // run once at least
            rp.poly()

            // rerun poly on an interval until onload
            var run = w.setInterval(rp.poly, 500)
            if (w.addEventListener) {
                w.addEventListener('load', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            } else if (w.attachEvent) {
                w.attachEvent('onload', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            }
        }

        // commonjs
        if (typeof exports !== 'undefined') {
            exports.loadCSS = loadCSS
        } else {
            w.loadCSS = loadCSS
        }
    })(typeof global !== 'undefined' ? global : this)
</script>

    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .footer-fixed-btn,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(
            -45deg,
            #444 0,
            #444 80px,
            #333 80px,
            #333 160px
        );
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }
</style>

    <link id="stylesheet-fancybox" rel="preload" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link id="stylesheet-base" rel="preload" href="/css/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link id="stylesheet-mobile" rel="preload" href="/css/mobile.css" as="style" onload="this.onload=null;this.rel='stylesheet';this.media='screen and (max-width: 960px)'">
    <link id="stylesheet-theme-dark" rel="preload" href="/css/dark.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" as="script">
    <link rel="preload" href="/scripts/main.js" as="script">
    <link rel="preload" href="/font/Oswald-Regular.ttf" as="font" crossorigin>
    <link rel="preload" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" as="font" crossorigin>
    <!-- algolia -->
    <!-- 百度统计  -->
    <!-- 谷歌统计  -->
    <!-- Google tag (gtag.js) -->
<meta name="generator" content="Hexo 7.3.0"><link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ == undefined) {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js" />')
        }
    </script>
        <body class="post-body">
        <!-- header -->
        <header class="header header-mobile">
    <!-- top read progress line -->
    <div class="header-element">
        <div class="read-progress"></div>
    </div>
    <!-- sidebar menu button -->
    <div class="header-element">
        <div class="header-sidebar-menu">
            <div style="padding-left: 1px;">&#xe775;</div>
        </div>
    </div>
    <!-- header actions -->
    <div class="header-actions">
        <!-- theme mode switch button -->
        <span class="header-theme-btn header-element">
            <i class="fas fa-adjust"></i>
        </span>
        <!-- back to home page text -->
        <span class="home-link header-element">
            <a href="/">BiribiriBird's Gallery.</a>
        </span>
    </div>
    <!-- toggle banner -->
    <div class="banner">
        <div class="blog-title header-element">
            <a href="/">BiribiriBird&#39;s Gallery.</a>
        </div>
        <div class="post-title header-element">
            <a href="#" class="post-name">Langchain入门笔记</a>
        </div>
    </div>
</header>

        <!-- fixed footer -->
        <footer class="footer-fixed">
    <!-- donate button -->

    <!-- back to top button -->
    <div class="footer-fixed-btn footer-fixed-btn--hidden back-top">
        <div>&#xe639;</div>
    </div>
</footer>

        <!-- wrapper -->
        <div class="wrapper">
            <div class="site-intro" style="    height:50vh;
">
    <!-- 主页  -->
    <!-- 404页  -->
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/post-bg.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
                Langchain入门笔记
            <!-- 404 -->
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            <!-- 404 -->
        </p>
        <!-- 文章页 meta -->
            <div class="post-intros">
                <!-- 文章页标签  -->
                    <div class="post-intro-tags" >
        <a class="post-tag" href="javascript:void(0);" data-tags="langchain">langchain</a>
</div>

                <!-- 文章字数统计 -->
                    <div class="post-intro-read">
                        <span>字数统计: <span class="post-count word-count">5.7k</span>阅读时长: <span class="post-count reading-time">25 min</span></span>
                    </div>
                <div class="post-intro-meta">
                    <!-- 撰写日期 -->
                    <span class="iconfont-archer post-intro-calander">&#xe676;</span>
                    <span class="post-intro-time">2024/08/11</span>
                    <!-- busuanzi -->
                        <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                            <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    <!-- 文章分享 -->
                    <span class="share-wrapper">
                        <span class="iconfont-archer share-icon">&#xe71d;</span>
                        <span class="share-text">Share</span>
                        <ul class="share-list">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
    </div>
</div>

            <script>
  // get user agent
  function getBrowserVersions() {
    var u = window.navigator.userAgent
    return {
      userAgent: u,
      trident: u.indexOf('Trident') > -1, //IE内核
      presto: u.indexOf('Presto') > -1, //opera内核
      webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
      gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
      mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
      ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
      android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
      iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
      iPad: u.indexOf('iPad') > -1, //是否为iPad
      webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
      weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
      uc: u.indexOf('UCBrowser') > -1, //是否为android下的UC浏览器
    }
  }
  var browser = {
    versions: getBrowserVersions(),
  }
  console.log('userAgent: ' + browser.versions.userAgent)

  // callback
  function fontLoaded() {
    console.log('font loaded')
    if (document.getElementsByClassName('site-intro-meta')) {
      document
        .getElementsByClassName('intro-title')[0]
        .classList.add('intro-fade-in')
      document
        .getElementsByClassName('intro-subtitle')[0]
        .classList.add('intro-fade-in')
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in')
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb() {
    if (browser.versions.uc) {
      console.log('UCBrowser')
      fontLoaded()
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular'],
        },
        loading: function () {
          // 所有字体开始加载
          // console.log('font loading');
        },
        active: function () {
          // 所有字体已渲染
          fontLoaded()
        },
        inactive: function () {
          // 字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout')
          fontLoaded()
        },
        timeout: 5000, // Set the timeout to two seconds
      })
    }
  }

  function asyncErr() {
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0]
    o.src = u
    if (cb) {
      o.addEventListener(
        'load',
        function (e) {
          cb(null, e)
        },
        false
      )
    }
    if (err) {
      o.addEventListener(
        'error',
        function (e) {
          err(null, e)
        },
        false
      )
    }
    s.parentNode.insertBefore(o, s)
  }

  var asyncLoadWithFallBack = function (arr, success, reject) {
    var currReject = function () {
      reject()
      arr.shift()
      if (arr.length) async(arr[0], success, currReject)
    }

    async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack(
    [
      'https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js',
      'https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js',
      "/lib/webfontloader.min.js",
    ],
    asyncCb,
    asyncErr
  )
</script>

            <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" alt="loading">
            <div class="container container-unloaded">
                <main class="main post-page">
    <article class="article-entry">
        <h1><span id="langchain入门">Langchain入门</span></h1>
<!-- toc -->
<ul>
<li><a href="#%E5%89%8D%E7%BD%AE%E5%B7%A5%E4%BD%9C">前置工作</a>
<ul>
<li><a href="#api-key%E9%85%8D%E7%BD%AE">API-KEY配置</a></li>
<li><a href="#api%E8%B0%83%E7%94%A8">API调用</a></li>
<li><a href="#promt-%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8">Promt 简单应用</a></li>
</ul>
</li>
<li><a href="#%E7%BB%84%E4%BB%B6">组件</a></li>
<li><a href="#models">Models</a>
<ul>
<li><a href="#llms">LLMs</a>
<ul>
<li><a href="#%E6%B5%81%E5%BC%8F%E8%BE%93%E5%87%BA">流式输出</a></li>
</ul>
</li>
<li><a href="#chat-models">Chat Models</a></li>
<li><a href="#embedding-models">Embedding models</a></li>
</ul>
</li>
<li><a href="#prompts">Prompts</a>
<ul>
<li><a href="#prompttemplate">PromptTemplate</a></li>
<li><a href="#fewshotprompttemplate">FewShotPromptTemplate</a></li>
</ul>
</li>
<li><a href="#chains">Chains</a>
<ul>
<li><a href="#llmchain">LLMChain</a></li>
<li><a href="#simplesequentialchain">SimpleSequentialChain</a></li>
<li><a href="#llmchain%E5%86%8D%E8%A7%A3%E9%87%8A">LLMChain（再解释）</a></li>
<li><a href="#simplesequentialchain%E5%86%8D%E8%A7%A3%E9%87%8A">SimpleSequentialChain（再解释）</a></li>
<li><a href="#sequentialchain">SequentialChain</a></li>
</ul>
</li>
<li><a href="#agents">Agents</a></li>
<li><a href="#memory">Memory</a>
<ul>
<li><a href="#chatmessagehistory">ChatMessageHistory</a></li>
<li><a href="#%E9%95%BF%E6%9C%9F%E8%AE%B0%E5%BF%86">长期记忆</a></li>
<li><a href="#conversationchains">ConversationChains</a></li>
</ul>
</li>
<li><a href="#indexes">Indexes</a>
<ul>
<li><a href="#textloader">TextLoader</a></li>
<li><a href="#charactertextsplitter">CharacterTextSplitter</a></li>
<li><a href="#%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93">向量数据库</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<blockquote>
<p>做的最多的事情就是自己查文档（</p>
<p>把文档查好基本就学完了</p>
<ul>
<li>**API：**通义千问</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/aoiJays/ECNU-cs-LangChain">完成品 - ECNU-cs-LangChain </a></p>
</blockquote>
<h2><span id="前置工作">前置工作</span></h2>
<blockquote>
<p>[Qwen API 文档](<a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/dashscope/developer-reference/use-qwen-by-api">如何使用通义千问API_模型服务灵积(DashScope)-阿里云帮助中心 (aliyun.com)</a>)</p>
</blockquote>
<p>先找个免费的API玩玩（</p>
<p>接口依旧使用openai那一套工具，比较友好</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -U openai <span class="comment"># 安装openai 包并升级到最新版本</span></span><br></pre></td></tr></table></figure>
<h3><span id="api-key配置">API-KEY配置</span></h3>
<p>然后拿一个api-key先</p>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/dashscope/developer-reference/acquisition-and-configuration-of-api-key?spm=a2c4g.11186623.0.0.65fe46c1Nhryxe">如何获取通义千问API的KEY_模型服务灵积(DashScope)-阿里云帮助中心 (aliyun.com)</a></p>
<p>显然不希望把自己的API-Key显式地暴露在代码里面</p>
<p>所以通过环境变量进行设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用 API-KEY 代替 YOUR_DASHSCOPE_API_KEY</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export DASHSCOPE_API_KEY=&#x27;sk-25580ab055e647bc9a63834d9f54358a&#x27;&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$DASHSCOPE_API_KEY</span> <span class="comment"># 输出成功则完成设置</span></span><br></pre></td></tr></table></figure>
<h3><span id="api调用">API调用</span></h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># openai.api_key = os.environ[&quot;DASHSCOPE_API_KEY&quot;]</span></span><br><span class="line"><span class="comment"># openai.api_base = &quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_completion</span>(<span class="params">prompt, model = <span class="string">&#x27;qwen1.5-1.8b-chat&#x27;</span></span>):</span><br><span class="line">    </span><br><span class="line">    client = openai.OpenAI(</span><br><span class="line">        api_key=os.environ[<span class="string">&quot;DASHSCOPE_API_KEY&quot;</span>], <span class="comment"># 调用环境变量</span></span><br><span class="line">        base_url=<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>,  </span><br><span class="line">        <span class="comment"># 填写DashScope服务的base_url</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    messages= [&#123;<span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;content&#x27;</span>: prompt&#125;]</span><br><span class="line">    </span><br><span class="line">    completion = client.chat.completions.create(</span><br><span class="line">        model = model, messages=messages, temperature=<span class="number">0</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> completion</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">get_completion(<span class="string">&#x27;1+1=?&#x27;</span>).model_dump_json() <span class="comment"># 转json</span></span><br><span class="line"><span class="comment"># get_completion(&#x27;1+1=?&#x27;).choices[0].message.content 直接获取回答</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>得到的completion对象：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;chatcmpl-bb28bd68-71b9-9265-9ec7-31f196e28d0c&quot;</span><span class="punctuation">,</span>  <span class="comment">// 完成请求的唯一标识符</span></span><br><span class="line">    <span class="attr">&quot;choices&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>  <span class="comment">// 模型生成的选项列表</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;finish_reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;stop&quot;</span><span class="punctuation">,</span>  <span class="comment">// 生成停止的原因（例如，停止标记、最大tokens等）</span></span><br><span class="line">            <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span>  <span class="comment">// 该选项在生成选项列表中的索引</span></span><br><span class="line">            <span class="attr">&quot;logprobs&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span>  <span class="comment">// tokens的对数概率（null表示没有返回对数概率）</span></span><br><span class="line">            <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1 + 1 equals 2.&quot;</span><span class="punctuation">,</span>  <span class="comment">// 模型生成的文本内容</span></span><br><span class="line">                <span class="attr">&quot;refusal&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span>  <span class="comment">// 拒绝理由（如果有的话）</span></span><br><span class="line">                <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;assistant&quot;</span><span class="punctuation">,</span>  <span class="comment">// 消息的角色（例如，用户或助手）</span></span><br><span class="line">                <span class="attr">&quot;function_call&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span>  <span class="comment">// 函数调用信息（如果有的话）</span></span><br><span class="line">                <span class="attr">&quot;tool_calls&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span>  <span class="comment">// 工具调用信息（如果有的话）</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;created&quot;</span><span class="punctuation">:</span> <span class="number">1723016017</span><span class="punctuation">,</span>  <span class="comment">// 创建时间（UNIX时间戳）</span></span><br><span class="line">    <span class="attr">&quot;model&quot;</span><span class="punctuation">:</span> <span class="string">&quot;qwen1.5-1.8b-chat&quot;</span><span class="punctuation">,</span>  <span class="comment">// 使用的模型名称</span></span><br><span class="line">    <span class="attr">&quot;object&quot;</span><span class="punctuation">:</span> <span class="string">&quot;chat.completion&quot;</span><span class="punctuation">,</span>  <span class="comment">// 对象类型（表示这是一个聊天完成请求）</span></span><br><span class="line">    <span class="attr">&quot;service_tier&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span>  <span class="comment">// 服务等级（如果适用）</span></span><br><span class="line">    <span class="attr">&quot;system_fingerprint&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span>  <span class="comment">// 系统指纹（如果适用）</span></span><br><span class="line">    <span class="attr">&quot;usage&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;completion_tokens&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span>  <span class="comment">// 完成响应使用的tokens数量</span></span><br><span class="line">        <span class="attr">&quot;prompt_tokens&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span>  <span class="comment">// 提示使用的tokens数量</span></span><br><span class="line">        <span class="attr">&quot;total_tokens&quot;</span><span class="punctuation">:</span> <span class="number">20</span>  <span class="comment">// 请求中使用的总tokens数量</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3><span id="promt-简单应用">Promt 简单应用</span></h3>
<p>考虑这样一个场景，我需要把收到的一段文本，更换表达语气：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&#x27;我对你的产品或服务没有任何兴趣。请立即从你的名单中删除我的号码，不要再打扰我。&#x27;</span></span><br></pre></td></tr></table></figure>
<p>我们希望更换成一个平淡的语气</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">style = <span class="string">&#x27;礼貌且谈吐得当、饱读诗书的语气&#x27;</span></span><br></pre></td></tr></table></figure>
<p>可以构建一个promt模板：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">prompt = <span class="string">f&quot;使用指定的风格、语气，转换以下文本。\n要求的风格是<span class="subst">&#123;style&#125;</span>\n文本：```<span class="subst">&#123;text&#125;</span>```&quot;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">使用指定的风格、语气，转换以下文本。</span></span><br><span class="line"><span class="string">要求的风格是礼貌且谈吐得当、饱读诗书的语气</span></span><br><span class="line"><span class="string">文本：```我对你的产品或服务没有任何兴趣。请立即从你的名单中删除我的号码，不要再打扰我。```</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>调用API即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get_completion(prompt)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;尊敬的客户，\n\n我希望您一切都好。鉴于我一直以来对贵公司的产品和服务持有基本的信任，但根据当前的需求和实际情况，我决定不再考虑与您的联系，并将其从我们的现有客户列表中移除。\n\n在过去的日子里，我在各种场合都阅读过大量关于贵公司的文章和评论，对其卓越的产品质量、专业服务以及深具影响力的市场地位深感敬佩。然而，最近在处理一些个人事务时，我偶然发现了一些令我不满之处，导致我需要重新评估我与贵公司之间的合作关系。\n\n对于这个决定，我有以下几个原因：首先，近期我接到了一个重要的商务电话会议，这可能意味着我将不得不在非常忙碌的环境中参与。基于这种时间压力和个人优先事项考量，我觉得更高效的方式是我能专注于这次会议，而非无谓地被您的电话打断。\n\n其次，我发现贵公司在某些方面存在一些疑虑和未解决的问题，这些问题可能会影响到我对贵公司的整体信任度和满意度。通过查阅相关资料和与相关人员进行深入交流，我了解到部分服务项目可能存在问题，例如处理效率低下、售后服务有待提升等。这些实际的问题与我对贵公司价值的认知相冲突，从而让我感到不适并难以接受。\n\n最后，我注意到您的服务热线经常出现噪音干扰和高分贝噪声，严重影响了我在通话过程中的专注力和工作效率。虽然我知道贵公司正在积极改善服务质量，但我认为通过优化电话系统的设置和维护，可以显著提高通话体验和质量，进一步增强我对贵公司的忠诚度和推荐度。\n\n综上所述，基于以上几点因素，我决定停止与贵公司的现有业务关系，并提出此请求。希望您能理解我的立场，并尽快采取行动，以满足我所提出的改进需求和期望，确保我们保持良好的沟通和合作关系。感谢您的理解和配合，期待在未来有机会与贵公司进行更深入的探讨和合作机会。\n\n顺祝商祺，\n[您的姓名]\n[您的职位]\n[联系方式]&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>接下来我们开始记录，如何使用Langchain，完成更加复杂的任务</p>
<h2><span id="组件">组件</span></h2>
<ul>
<li>Models</li>
<li>Prompts</li>
<li>Memory</li>
<li>Indexes</li>
<li>Chains</li>
<li>Agents</li>
</ul>
<h2><span id="models">Models</span></h2>
<ul>
<li>LLMs
<ul>
<li>输入：文本字符串</li>
<li>输出：文本字符串</li>
</ul>
</li>
<li>Chat Models
<ul>
<li>输入：聊天消息列表</li>
<li>输出：聊天消息</li>
</ul>
</li>
<li>Text Embbeding Models
<ul>
<li>输入：文本</li>
<li>输出：浮点数列表</li>
</ul>
</li>
</ul>
<h3><span id="llms">LLMs</span></h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://python.langchain.com/v0.2/docs/integrations/llms/tongyi/">文档：Models - LLMs - Tongyi Qwen | 🦜️🔗 LangChain</a></p>
<p><a target="_blank" rel="noopener" href="https://api.python.langchain.com/en/latest/llms/langchain_community.llms.tongyi.Tongyi.html">Tongyi对象文档：langchain_community.llms.tongyi.Tongyi — 🦜🔗 LangChain 0.2.12</a></p>
</blockquote>
<p>使用的是通义千问提供的API，因此前往langchain对于通义千问的封装文档即可</p>
<p>首先安装langchain的langchain-community库</p>
<p>因为是通义千问的，所以还需要安装一下<code>dashscope</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade --quiet  langchain-community dashscope</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.llms <span class="keyword">import</span> Tongyi</span><br><span class="line">llm = Tongyi( </span><br><span class="line">    model_name=<span class="string">&quot;qwen1.5-1.8b-chat&quot;</span>, </span><br><span class="line">    temperature=<span class="number">0.95</span>, </span><br><span class="line">    top_p=<span class="number">0.7</span>, </span><br><span class="line">    max_tokens=<span class="number">100</span> </span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>( llm.invoke(<span class="string">&quot;你好吗？&quot;</span>) ) <span class="comment"># 字符串形式输入输出</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>temperature</code> 参数（T）调整softmax的分布，控制模型输出的随机性</p>
<ul>
<li>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub><mo>=</mo><mfrac><mrow><mi>exp</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>o</mi><mi>i</mi></msub><mi mathvariant="normal">/</mi><mi>T</mi><mo stretchy="false">)</mo></mrow><mrow><munder><mo>∑</mo><mi>j</mi></munder><mi>exp</mi><mo>⁡</mo><mrow><mo stretchy="false">(</mo><msub><mi>o</mi><mi>j</mi></msub><mi mathvariant="normal">/</mi><mi>T</mi><mo stretchy="false">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">p_i = \frac{\exp(o_i/T)}{\sum_j \exp{(o_j/T)}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.5488180000000003em;vertical-align:-1.1218180000000002em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16195399999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.43581800000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">exp</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mclose">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">exp</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1218180000000002em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
</li>
<li>
<p>T越小，生成越保守。T越大，生成越随机（相当于所有概率都相等）</p>
</li>
<li>
<p>T=1，无调整</p>
</li>
</ul>
</li>
<li>
<p><code>top_p</code></p>
<ul>
<li>累计概率靠前的几个token的概率值，当概率和到达<code>top_p</code>时，不再考虑剩下的token</li>
</ul>
</li>
<li>
<p><code>top_k</code></p>
<ul>
<li>考虑的token数量</li>
</ul>
</li>
</ul>
<h4><span id="流式输出">流式输出</span></h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="comment"># 流式输出</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">stream_words</span>(<span class="params">prompt, llm</span>):</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">for</span> chunk <span class="keyword">in</span> llm.astream([prompt]):</span><br><span class="line">        words = chunk.split()</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;word&#125;</span>&quot;</span>, end=<span class="string">&#x27;&#x27;</span>, flush=<span class="literal">True</span>) </span><br><span class="line">   </span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行主函数</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    prompt = <span class="string">&quot;讲一个故事，不超过30字&quot;</span></span><br><span class="line">    llm = Tongyi( model_name=<span class="string">&quot;qwen1.5-1.8b-chat&quot;</span>, temperature=<span class="number">0.95</span>, top_p=<span class="number">0.7</span>, max_tokens=<span class="number">10</span>, streaming = <span class="literal">True</span>)</span><br><span class="line">    asyncio.run(stream_words(prompt, llm))</span><br></pre></td></tr></table></figure>
<h3><span id="chat-models">Chat Models</span></h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://python.langchain.com/v0.2/docs/integrations/chat/tongyi/">文档：Models - Chat Models - ChatTongyi | 🦜️🔗 LangChain</a></p>
<p><a target="_blank" rel="noopener" href="https://api.python.langchain.com/en/latest/chat_models/langchain_community.chat_models.tongyi.ChatTongyi.html">对象文档：langchain_community.chat_models.tongyi.ChatTongyi — 🦜🔗 LangChain 0.2.12</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.chat_models.tongyi <span class="keyword">import</span> ChatTongyi</span><br><span class="line">chatLLM = ChatTongyi(</span><br><span class="line">    model_name=<span class="string">&quot;qwen1.5-1.8b-chat&quot;</span>, temperature=<span class="number">0.95</span>, </span><br><span class="line">    top_p=<span class="number">0.7</span>, max_tokens=<span class="number">500</span> </span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>我们有两种方法对消息进行定义</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> HumanMessage, SystemMessage</span><br><span class="line">messages = [</span><br><span class="line">    SystemMessage(</span><br><span class="line">        content=<span class="string">&quot;You are a helpful assistant that translates English to French.&quot;</span></span><br><span class="line">    ),</span><br><span class="line">    HumanMessage(</span><br><span class="line">        content=<span class="string">&quot;Translate this sentence from English to French. I love programming.&quot;</span></span><br><span class="line">    ),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">messages = [</span><br><span class="line">    (<span class="string">&quot;system&quot;</span>, <span class="string">&quot;你是一名专业的翻译家，可以将用户的中文翻译为英文。&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;human&quot;</span>, <span class="string">&quot;我喜欢编程。&quot;</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>最后：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chatLLM.invoke(messages) <span class="comment"># 或者直接 chatLLM(messages)</span></span><br><span class="line"><span class="comment"># 推荐invoke</span></span><br></pre></td></tr></table></figure>
<p>返回内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">AIMessage(</span><br><span class="line">    content=<span class="string">&quot;J&#x27;aime programmer.&quot;</span>, </span><br><span class="line">    response_metadata=&#123;</span><br><span class="line">        <span class="string">&#x27;model_name&#x27;</span>: <span class="string">&#x27;qwen1.5-1.8b-chat&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;finish_reason&#x27;</span>: <span class="string">&#x27;stop&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;request_id&#x27;</span>: <span class="string">&#x27;810ae9a8-1365-913b-a2d2-f4b6be06cf58&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;token_usage&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;input_tokens&#x27;</span>: <span class="number">36</span>, </span><br><span class="line">            <span class="string">&#x27;output_tokens&#x27;</span>: <span class="number">5</span>, </span><br><span class="line">            <span class="string">&#x27;total_tokens&#x27;</span>: <span class="number">41</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="built_in">id</span>=<span class="string">&#x27;run-5ee38ee1-f1f2-4b65-9b37-584dd64ee2ee-0&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>相比使用LLMs获得了更多其他信息</p>
<h3><span id="embedding-models">Embedding models</span></h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://python.langchain.com/v0.2/docs/integrations/text_embedding/dashscope/">文档：DashScope | 🦜️🔗 LangChain</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.embeddings <span class="keyword">import</span> DashScopeEmbeddings</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">embeddings = DashScopeEmbeddings(</span><br><span class="line">    model=<span class="string">&quot;text-embedding-v1&quot;</span>, dashscope_api_key=os.environ[<span class="string">&quot;DASHSCOPE_API_KEY&quot;</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;Kurokawa Akane&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 单个文本的词嵌入</span></span><br><span class="line">query_result = embeddings.embed_query(text)</span><br><span class="line"><span class="built_in">print</span>(query_result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多个</span></span><br><span class="line">doc_results = embeddings.embed_documents([<span class="string">&quot;Kurokawa Akane&quot;</span>,<span class="string">&quot;Kurokawa Akane&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>(doc_results)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 均输出浮点数列表</span></span><br></pre></td></tr></table></figure>
<h2><span id="prompts">Prompts</span></h2>
<h3><span id="prompttemplate">PromptTemplate</span></h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://api.python.langchain.com/en/latest/prompts/langchain_core.prompts.prompt.PromptTemplate.html">文档：PromptTemplate</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.llms <span class="keyword">import</span> Tongyi</span><br><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法1：PromptTemplate构造函数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 模板定义</span></span><br><span class="line">template = <span class="string">&quot;一句话介绍一下明日方舟干员&#123;Operators&#125;的身份&quot;</span></span><br><span class="line"><span class="comment"># 构建组件</span></span><br><span class="line">prompt = PromptTemplate(template=template, input_variables=[<span class="string">&quot;Operators&quot;</span>])</span><br><span class="line"><span class="comment"># 生成模板</span></span><br><span class="line">prompt_text = prompt.<span class="built_in">format</span>(Operators=<span class="string">&quot;缪尔赛斯&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># --------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法2：from_template</span></span><br><span class="line">template = <span class="string">&quot;一句话介绍一下明日方舟干员&#123;Operators&#125;的身份&quot;</span></span><br><span class="line">prompt = PromptTemplate.from_template(template)</span><br><span class="line">prompt_text = prompt.<span class="built_in">format</span>(Operators=<span class="string">&quot;缪尔赛斯&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># --------------------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">llm = Tongyi( model_name=<span class="string">&quot;qwen1.5-1.8b-chat&quot;</span>, temperature=<span class="number">0.95</span>, top_p=<span class="number">0.7</span>, max_tokens=<span class="number">100</span> )</span><br><span class="line"></span><br><span class="line">llm(prompt_text)</span><br></pre></td></tr></table></figure>
<h3><span id="fewshotprompttemplate">FewShotPromptTemplate</span></h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://api.python.langchain.com/en/latest/prompts/langchain_core.prompts.few_shot.FewShotPromptTemplate.html#">文档：FewShotPromptTemplate</a></p>
<ul>
<li>Zero-shot 是指模型在没有见过任何特定任务的训练数据的情况下进行预测</li>
<li>One-shot 是指模型在仅见过一个训练样本的情况下进行学习和预测</li>
<li>Few-shot 是指模型在见过很少量的训练样本（几个到几十个）的情况下进行学习和预测</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.prompts.few_shot <span class="keyword">import</span> FewShotPromptTemplate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 样例准备</span></span><br><span class="line"><span class="comment"># 相当于会组合样例以及模板 成为真正的样例</span></span><br><span class="line">examples = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Operators&quot;</span>: <span class="string">&quot;令&quot;</span>, </span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;令，一位辅助干员&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Operators&quot;</span>: <span class="string">&quot;斯卡蒂&quot;</span>, </span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;斯卡蒂，一位近卫干员&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Operators&quot;</span>: <span class="string">&quot;缪尔赛斯&quot;</span>, </span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;缪尔赛斯, 一位先锋干员&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">example_template = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">明日方舟干员：&#123;Operators&#125;</span></span><br><span class="line"><span class="string">描述：&#123;description&#125;\n</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">example_prompt = PromptTemplate.from_template(example_template)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">few_shot_prompt = FewShotPromptTemplate(</span><br><span class="line">    examples = examples, </span><br><span class="line">    example_prompt = example_prompt, </span><br><span class="line">    </span><br><span class="line">	<span class="comment"># 真实提问</span></span><br><span class="line">    prefix = <span class="string">&quot;给出每个干员的姓名，描述每一位干员的身份&quot;</span>,</span><br><span class="line">    suffix = <span class="string">&quot;明日方舟干员：&#123;Operators&#125;\n描述：\n&quot;</span>,</span><br><span class="line">    input_variables=[<span class="string">&quot;Operators&quot;</span>],</span><br><span class="line">    example_separator = <span class="string">&quot;\n&quot;</span> <span class="comment"># 样例直接隔开</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">prompt_text = few_shot_prompt.<span class="built_in">format</span>(Operators=<span class="string">&quot;黍&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(prompt_text)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># prompt_text:</span></span><br><span class="line"><span class="string">给出每个干员的姓名，描述每一位干员的身份</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">明日方舟干员：令</span></span><br><span class="line"><span class="string">描述：令，一位辅助干员</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">明日方舟干员：斯卡蒂</span></span><br><span class="line"><span class="string">描述：斯卡蒂，一位近卫干员</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">明日方舟干员：缪尔赛斯</span></span><br><span class="line"><span class="string">描述：缪尔赛斯, 一位先锋干员</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">明日方舟干员：黍</span></span><br><span class="line"><span class="string">描述：</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(llm(prompt_text))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># 输出</span></span><br><span class="line"><span class="string">明日方舟干员：谷粒</span></span><br><span class="line"><span class="string">描述：谷粒，一位研究者干员</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 至少格式对了</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2><span id="chains">Chains</span></h2>
<h3><span id="llmchain">LLMChain</span></h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://api.python.langchain.com/en/latest/chains/langchain.chains.llm.LLMChain.html#langchain.chains.llm.LLMChain">对象文档：LLMChain</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> LLMChain</span><br><span class="line"><span class="comment"># 指定模型 指定prompt</span></span><br><span class="line">chain1 = LLMChain(llm=llm, prompt=few_shot_prompt)</span><br><span class="line">chain1.invoke(<span class="string">&quot;黍&quot;</span>)</span><br><span class="line"><span class="comment"># &#123;&#x27;Operators&#x27;: &#x27;黍&#x27;, &#x27;text&#x27;: &#x27;明日方舟干员：谷粒\n描述：谷粒，一位研究者干员&#x27;&#125;</span></span><br></pre></td></tr></table></figure>
<p>需要多个参数时：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 模板定义</span></span><br><span class="line">template = <span class="string">&quot;&#123;a&#125; + &#123;b&#125; = ?&quot;</span></span><br><span class="line"><span class="comment"># 构建组件</span></span><br><span class="line">prompt = PromptTemplate.from_template(template)</span><br><span class="line"></span><br><span class="line">chain2 = LLMChain(llm=llm, prompt=prompt)</span><br><span class="line">chain2.invoke(&#123;<span class="string">&quot;a&quot;</span>: <span class="string">&quot;100&quot;</span>, <span class="string">&quot;b&quot;</span>: <span class="string">&quot;200&quot;</span>&#125;)</span><br><span class="line"><span class="comment"># &#123;&#x27;a&#x27;: &#x27;100&#x27;, &#x27;b&#x27;: &#x27;200&#x27;, &#x27;text&#x27;: &#x27;300&#x27;&#125;</span></span><br></pre></td></tr></table></figure>
<h3><span id="simplesequentialchain">SimpleSequentialChain</span></h3>
<p>将上一个chain的输出作为当前chain的输入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">template = <span class="string">&quot;&#123;country&#125;的首都是哪个城市？用一个词回答&quot;</span></span><br><span class="line">prompt = PromptTemplate.from_template(template)</span><br><span class="line">chain1 = LLMChain(llm=llm, prompt=prompt)</span><br><span class="line"></span><br><span class="line">template2 = <span class="string">&quot;&#123;city&#125;有哪些景点值得参观？用一句话列举&quot;</span></span><br><span class="line">prompt2 = PromptTemplate.from_template(template2)</span><br><span class="line">chain2 = LLMChain(llm=llm, prompt=prompt2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 组装</span></span><br><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> SimpleSequentialChain</span><br><span class="line">chains = SimpleSequentialChain(chains=[chain1, chain2], verbose=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># verbose=True，可以看见推理的步骤</span></span><br><span class="line">chains.run(<span class="string">&quot;中国&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&gt; Entering new SimpleSequentialChain chain...</span></span><br><span class="line"><span class="string">首都：北京。</span></span><br><span class="line"><span class="string">故宫、天安门广场、长城、颐和园、鸟巢等。</span></span><br><span class="line"><span class="string">&gt; Finished chain.</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># 真实输出</span></span><br><span class="line"><span class="string">&#x27;故宫、天安门广场、长城、颐和园、鸟巢等。&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3><span id="llmchain再解释">LLMChain（再解释）</span></h3>
<p>每一个LLMChain，绑定了模型和prompt</p>
<p>成为一个单独的元素</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> LLMChain</span><br><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"></span><br><span class="line"><span class="comment"># LLMChain1 英文翻译中文</span></span><br><span class="line">chain1_prompt = PromptTemplate.from_template(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">请将以下文本翻译成流畅的中文：</span></span><br><span class="line"><span class="string">文本：&#123;txt1&#125;</span></span><br><span class="line"><span class="string">翻译：</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">chain1 = LLMChain(llm=llm, prompt=chain1_prompt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># LLMChain2 中文归纳</span></span><br><span class="line">chain2_prompt = PromptTemplate.from_template(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">请用简洁的一句话，概括以下文本：</span></span><br><span class="line"><span class="string">文本：&#123;txt2&#125;</span></span><br><span class="line"><span class="string">概括：</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">chain2 = LLMChain(llm=llm, prompt=chain2_prompt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># LLMChain3 新闻标题</span></span><br><span class="line">chain3_prompt = PromptTemplate.from_template(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">请为以下文本生成一个简洁且吸引人的新闻标题：</span></span><br><span class="line"><span class="string">文本：&#123;txt3&#125;</span></span><br><span class="line"><span class="string">新闻标题：</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">chain3 = LLMChain(llm=llm, prompt=chain3_prompt)</span><br></pre></td></tr></table></figure>
<h3><span id="simplesequentialchain再解释">SimpleSequentialChain（再解释）</span></h3>
<ul>
<li>每个LLMChain的输出，将作为下一个LLMChain的输入</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> SimpleSequentialChain</span><br><span class="line">chains = SimpleSequentialChain(</span><br><span class="line">    chains = [ chain1, chain2, chain3], </span><br><span class="line">    verbose = <span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">chains.invoke(txt)</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&gt; Entering new SimpleSequentialChain chain...</span></span><br><span class="line"><span class="string">近年来，莫尔斯西小姐在哥伦比亚学术界享有极高的声誉。她在不到30岁的时候，就已经成为Rhein Life十强人物之一，担任生态学与环境科学大学副校长一职，并担任特雷蒙多大学客座讲师。过去十年间，莫尔斯西及其研究团队在生态学、遗传学、植物生物化学和植物生理等领域取得了显著突破，对哥伦比亚生命科学和环境科学的发展做出了重要贡献。</span></span><br><span class="line"><span class="string">莫尔斯西小姐在哥伦比亚学术界享有极高声誉，是知名生态学与环境科学大学副校长及特雷蒙多大学客座讲师，在近十年间在多个领域取得显著突破，对哥伦比亚生命科学和环境科学发展做出重要贡献。</span></span><br><span class="line"><span class="string">&quot;哥伦比亚学者莫尔斯西小姐：杰出生态学家、客座讲师，近十年里多项研究成果瞩目，引领哥伦比亚生命科学和环境科学发展&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt; Finished chain.</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3><span id="sequentialchain">SequentialChain</span></h3>
<p>我们需要更加复杂的chain关系</p>
<ul>
<li>第三个LLMChain的输入，由第一个和第二个提供……</li>
</ul>
<p>我们将对模板以及LLMChain的key非常敏感</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> LLMChain</span><br><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"></span><br><span class="line"><span class="comment"># LLMChain1 英文翻译中文</span></span><br><span class="line">chain1_prompt = PromptTemplate.from_template(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">请将以下文本翻译成流畅的中文：</span></span><br><span class="line"><span class="string">文本：&#123;Source_txt&#125;</span></span><br><span class="line"><span class="string">翻译：</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">chain1 = LLMChain(llm=llm, prompt=chain1_prompt, output_key=<span class="string">&#x27;Translated_txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># LLMChain2 语言分类</span></span><br><span class="line">chain2_prompt = PromptTemplate.from_template(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">这一段文本使用的是哪一种语言？</span></span><br><span class="line"><span class="string">文本：&#123;Source_txt&#125;</span></span><br><span class="line"><span class="string">语言：</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">chain2 = LLMChain(llm=llm, prompt=chain2_prompt, output_key=<span class="string">&#x27;answer&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># LLMChain3 中文归纳</span></span><br><span class="line">chain3_prompt = PromptTemplate.from_template(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">请用简洁的一句话，概括以下文本：</span></span><br><span class="line"><span class="string">文本：&#123;Translated_txt&#125;</span></span><br><span class="line"><span class="string">概括：</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">chain3 = LLMChain(llm=llm, prompt=chain3_prompt, output_key=<span class="string">&#x27;summary&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> SequentialChain</span><br><span class="line">chains = SequentialChain(</span><br><span class="line">    chains = [chain1, chain2, chain3],</span><br><span class="line">    input_variables = [<span class="string">&#x27;Source_txt&#x27;</span>],</span><br><span class="line">    output_variables = [<span class="string">&#x27;Translated_txt&#x27;</span>,<span class="string">&#x27;answer&#x27;</span>, <span class="string">&#x27;summary&#x27;</span>], <span class="comment"># 如果希望返回中间的输出结果</span></span><br><span class="line">    verbose=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">chains.invoke(txt)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#123;&#x27;Source_txt&#x27;: &#x27;Miss Muelsyse is a highly regarded genius scientist in the academic circles of Columbia in recent years. At less than thirty years old, she has already become one of the top ten figures at Rhine Life, serving as the Director of Ecology and a guest lecturer at the University of Trimondo. Over the past decade, Miss Muelsyse and her research team have made significant advancements in various fields, including ecology, genetics, plant biochemistry, and plant physiology, greatly contributing to the development of life sciences and environmental sciences in Columbia.&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;Translated_txt&#x27;: &#x27;近年来，莫尔斯西小姐在哥伦比亚学术界享有极高的声誉。她在不到30岁的时候，就已经成为Rhein Life十强人物之一，担任生态学与环境科学大学副校长一职，并担任特雷蒙多大学客座讲师。过去十年间，莫尔斯西及其研究团队在生态学、遗传学、植物生物化学和植物生理等领域取得了显著突破，对哥伦比亚生命科学和环境科学的发展做出了重要贡献。&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;answer&#x27;: &#x27;这段文本使用了英语。&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;summary&#x27;: &#x27;莫尔斯西小姐在哥伦比亚学术界享有极高声誉，是知名生态学与环境科学大学副校长及特雷蒙多大学客座讲师，在近十年间在多个领域取得显著突破，对哥伦比亚生命科学和环境科学发展做出重要贡献。&#x27;&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2><span id="agents">Agents</span></h2>
<p>预训练的LLM能力有限（数学能力、逻辑、实时信息），需要引入第三方工具进行辅助</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://python.langchain.com/v0.2/docs/integrations/toolkits/">Toolkits | 🦜️🔗 LangChain</a></p>
<p><a target="_blank" rel="noopener" href="https://python.langchain.com/v0.2/docs/integrations/tools/">Tools | 🦜️🔗 LangChain</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">!pip install numexpr</span><br><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> load_tools, initialize_agent, AgentType</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载第三方工具</span></span><br><span class="line">tools = load_tools([<span class="string">&quot;llm-math&quot;</span>], llm=llm)</span><br><span class="line"><span class="comment"># 初始化agent</span></span><br><span class="line">agent = initialize_agent(tools, llm, agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION, verbose=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">agent.run(<span class="string">&quot;Assume you are 12 years old now, what&#x27;s your age raised to the 0.43 power?&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">To calculate the amount by which my current age is raised to the power of 0.43, we first need to determine my current age and then multiply it by 0.43.</span></span><br><span class="line"><span class="string">My current age:</span></span><br><span class="line"><span class="string">Since I am currently 12 years old, my current age is 12.</span></span><br><span class="line"><span class="string">To find the power 0.43, we divide the current age by 0.43:</span></span><br><span class="line"><span class="string">Power = Current Age / 0.43</span></span><br><span class="line"><span class="string">Power = 12 / 0.43</span></span><br><span class="line"><span class="string">Power ≈ 30.867294153885714</span></span><br><span class="line"><span class="string">Thought: The calculation has been completed successfully.</span></span><br><span class="line"><span class="string">Final Answer: My current age raised to the 0.43 power is approximately 30.87.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt; Finished chain.</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2><span id="memory">Memory</span></h2>
<h3><span id="chatmessagehistory">ChatMessageHistory</span></h3>
<ul>
<li>记录消息存储记录</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.memory <span class="keyword">import</span> ChatMessageHistory</span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录消息存储记录</span></span><br><span class="line">history = ChatMessageHistory()</span><br><span class="line"></span><br><span class="line">history.add_user_message(<span class="string">&quot;今天开学&quot;</span>) <span class="comment"># user</span></span><br><span class="line">history.add_ai_message(<span class="string">&quot;好的，明天见&quot;</span>) <span class="comment"># ai</span></span><br><span class="line"></span><br><span class="line">history.messages <span class="comment"># 查看消息记录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [HumanMessage(content=&#x27;今天开学&#x27;), AIMessage(content=&#x27;好的，明天见&#x27;)]</span></span><br></pre></td></tr></table></figure>
<h3><span id="长期记忆">长期记忆</span></h3>
<p>我们需要把之前的对话存储下来，可以考虑存储成字典形式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.memory <span class="keyword">import</span> ChatMessageHistory</span><br><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> messages_to_dict, messages_from_dict</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意messages和message是不一样的，前者是列表，后者是单个消息</span></span><br><span class="line"><span class="comment"># 这里使用s</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">history = ChatMessageHistory()</span><br><span class="line"></span><br><span class="line">history.add_user_message(<span class="string">&quot;今天开学&quot;</span>) <span class="comment"># user</span></span><br><span class="line">history.add_ai_message(<span class="string">&quot;好的，明天见&quot;</span>) <span class="comment"># ai</span></span><br><span class="line"></span><br><span class="line">dicts = messages_to_dict(history.messages)</span><br><span class="line"><span class="built_in">print</span>(dicts)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[&#123;&#x27;type&#x27;: &#x27;human&#x27;, &#x27;data&#x27;: &#123;&#x27;content&#x27;: &#x27;今天开学&#x27;, &#x27;additional_kwargs&#x27;: &#123;&#125;, &#x27;response_metadata&#x27;: &#123;&#125;, &#x27;type&#x27;: &#x27;human&#x27;, &#x27;name&#x27;: None, &#x27;id&#x27;: None, &#x27;example&#x27;: False&#125;&#125;, &#123;&#x27;type&#x27;: &#x27;ai&#x27;, &#x27;data&#x27;: &#123;&#x27;content&#x27;: &#x27;好的，明天见&#x27;, &#x27;additional_kwargs&#x27;: &#123;&#125;, &#x27;response_metadata&#x27;: &#123;&#125;, &#x27;type&#x27;: &#x27;ai&#x27;, &#x27;name&#x27;: None, &#x27;id&#x27;: None, &#x27;example&#x27;: False, &#x27;tool_calls&#x27;: [], &#x27;invalid_tool_calls&#x27;: [], &#x27;usage_metadata&#x27;: None&#125;&#125;]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">new_history = messages_from_dict(dicts)</span><br><span class="line"><span class="built_in">print</span>(new_history)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[HumanMessage(content=&#x27;今天开学&#x27;), AIMessage(content=&#x27;好的，明天见&#x27;)]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3><span id="conversationchains">ConversationChains</span></h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> ConversationChain</span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持记录的对话chain</span></span><br><span class="line">conversation = ConversationChain(llm=llm, verbose=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>我们可以看一下template</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;The following is a friendly conversation between a human and an AI. The AI is talkative and provides lots of specific details from its context. If the AI does not know the answer to a question, it truthfully says it does not know. </span></span><br><span class="line"><span class="string">Current conversation: &#123;history&#125;</span></span><br><span class="line"><span class="string">Human: &#123;input&#125;</span></span><br><span class="line"><span class="string">AI:</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>每次都会存储之前的历史记录，放入本次的输入，让AI填写新的回复内容</p>
<p>为了防止回复词数过多，稍微修改了一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">conversation.prompt.template = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">The following is a friendly conversation between a human and an AI. The AI is talkative and provides lots of specific details from its context. If the AI does not know the answer to a question, it truthfully says it does not know.</span></span><br><span class="line"><span class="string">Current conversation:</span></span><br><span class="line"><span class="string">&#123;history&#125;</span></span><br><span class="line"><span class="string">Human: &#123;input&#125;</span></span><br><span class="line"><span class="string">AI:</span></span><br><span class="line"><span class="string">注意，只允许使用不超过10个字进行简单回答</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">response = conversation.predict(<span class="built_in">input</span>=<span class="string">&#x27;我姐姐明天要过生日，推荐一束生日花束的种类。&#x27;</span>)</span><br><span class="line">response = conversation.predict(<span class="built_in">input</span>=<span class="string">&#x27;她喜欢的颜色是粉色的。&#x27;</span>)</span><br><span class="line">response = conversation.predict(<span class="built_in">input</span>=<span class="string">&#x27;我为什么要买花&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conversation.memory.chat_memory.messages</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[HumanMessage(content=&#x27;我姐姐明天要过生日，推荐一束生日花束的种类。&#x27;),</span></span><br><span class="line"><span class="string"> AIMessage(content=&#x27;&quot;玫瑰、百合、郁金香、康乃馨、太阳花&quot;。&#x27;),</span></span><br><span class="line"><span class="string"> HumanMessage(content=&#x27;她喜欢的颜色是粉色的。&#x27;),</span></span><br><span class="line"><span class="string"> AIMessage(content=&#x27;粉色康乃馨。&#x27;),</span></span><br><span class="line"><span class="string"> HumanMessage(content=&#x27;我为什么要买花&#x27;),</span></span><br><span class="line"><span class="string"> AIMessage(content=&#x27;为了庆祝她生日。&#x27;)]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2><span id="indexes">Indexes</span></h2>
<p>对文档（txt、pdf、md……）进行处理、检索</p>
<h3><span id="textloader">TextLoader</span></h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.document_loaders <span class="keyword">import</span> TextLoader</span><br><span class="line"></span><br><span class="line">loader = TextLoader(<span class="string">&#x27;source.txt&#x27;</span>)</span><br><span class="line">txt = loader.load() <span class="comment"># 加载文档</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(txt)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(txt))</span><br><span class="line"></span><br><span class="line"><span class="comment"># [Document(metadata=&#123;&#x27;source&#x27;: &#x27;source.txt&#x27;&#125;, page_content=&#x27;【代号】缪尔赛思\n【性别】女\n【战斗经验】没有战斗经验\n【出身地】未公开\n【生日】11月3日\n【种族】精灵\n【身高】169cm\n【矿石病感染情况】\n参照医学检测报告，确认为非感染者。&#x27;)]</span></span><br><span class="line"><span class="comment"># 1</span></span><br></pre></td></tr></table></figure>
<h3><span id="charactertextsplitter">CharacterTextSplitter</span></h3>
<ul>
<li>常将文本切分成多个段</li>
<li>切分方式
<ul>
<li>按字数，简单，但是容易切出没意义的段落</li>
<li>按特殊字符，例如回车符</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.text_splitter <span class="keyword">import</span> CharacterTextSplitter</span><br><span class="line">text_splitter = CharacterTextSplitter(</span><br><span class="line">    separator=<span class="string">&#x27;\n&#x27;</span>, <span class="comment"># 切分符</span></span><br><span class="line">    chunk_size=<span class="number">10</span>,  <span class="comment"># chunk大小</span></span><br><span class="line">    chunk_overlap=<span class="number">0</span> <span class="comment"># 重叠</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切割成字符串列表</span></span><br><span class="line">txt_doc = text_splitter.split_text(txt[<span class="number">0</span>].page_content)</span><br><span class="line"><span class="built_in">print</span>(txt_doc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切割成document对象列表</span></span><br><span class="line">texts = text_splitter.split_documents(txt)</span><br><span class="line"><span class="built_in">print</span>(texts)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[&#x27;【代号】缪尔赛思&#x27;, &#x27;【性别】女&#x27;, &#x27;【战斗经验】没有战斗经验&#x27;, &#x27;【出身地】未公开&#x27;, &#x27;【生日】11月3日&#x27;, &#x27;【种族】精灵&#x27;, &#x27;【身高】169cm&#x27;, &#x27;【矿石病感染情况】&#x27;, &#x27;参照医学检测报告，确认为非感染者。&#x27;]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Document(metadata=&#123;&#x27;source&#x27;: &#x27;source.txt&#x27;&#125;, page_content=&#x27;【代号】缪尔赛思&#x27;), Document(metadata=&#123;&#x27;source&#x27;: &#x27;source.txt&#x27;&#125;, page_content=&#x27;【性别】女&#x27;), Document(metadata=&#123;&#x27;source&#x27;: &#x27;source.txt&#x27;&#125;, page_content=&#x27;【战斗经验】没有战斗经验&#x27;), Document(metadata=&#123;&#x27;source&#x27;: &#x27;source.txt&#x27;&#125;, page_content=&#x27;【出身地】未公开&#x27;), Document(metadata=&#123;&#x27;source&#x27;: &#x27;source.txt&#x27;&#125;, page_content=&#x27;【生日】11月3日&#x27;), Document(metadata=&#123;&#x27;source&#x27;: &#x27;source.txt&#x27;&#125;, page_content=&#x27;【种族】精灵&#x27;), Document(metadata=&#123;&#x27;source&#x27;: &#x27;source.txt&#x27;&#125;, page_content=&#x27;【身高】169cm&#x27;), Document(metadata=&#123;&#x27;source&#x27;: &#x27;source.txt&#x27;&#125;, page_content=&#x27;【矿石病感染情况】&#x27;), Document(metadata=&#123;&#x27;source&#x27;: &#x27;source.txt&#x27;&#125;, page_content=&#x27;参照医学检测报告，确认为非感染者。&#x27;)]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3><span id="向量数据库">向量数据库</span></h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> FAISS</span><br><span class="line"><span class="keyword">from</span> langchain_community.embeddings <span class="keyword">import</span> DashScopeEmbeddings</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">embeddings = DashScopeEmbeddings(</span><br><span class="line">    model=<span class="string">&quot;text-embedding-v1&quot;</span>, dashscope_api_key=os.environ[<span class="string">&quot;DASHSCOPE_API_KEY&quot;</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">db = FAISS.from_documents(documents, embeddings) <span class="comment"># 构建数据库</span></span><br><span class="line">retriever = db.as_retriever( <span class="comment"># 转换为检索器 返回最相关的k个文档</span></span><br><span class="line">    search_kwargs = &#123;</span><br><span class="line">        <span class="string">&#x27;k&#x27;</span>: <span class="number">2</span></span><br><span class="line">	&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">result = retriever.get_relevant_documents(<span class="string">&quot;学院共有几次晋级ICPC国际大学生程序设计竞赛全球总决赛，分别是哪几年？&quot;</span>)</span><br><span class="line">result</span><br><span class="line"></span><br></pre></td></tr></table></figure>

    </article>
    <!-- license -->
        <div class="license-wrapper">
            <p>原文作者：<a href="https://aoijays.top">BiribiriBird</a>
            <p>原文链接：<a href="https://aoijays.top/2024/08/11/langchain-zero/">https://aoijays.top/2024/08/11/langchain-zero/</a>
            <p>发表日期：<a href="https://aoijays.top/2024/08/11/langchain-zero/">August 11th 2024, 5:04:46 pm</a>
            <p>更新日期：<a href="https://aoijays.top/2024/08/11/langchain-zero/">August 11th 2024, 5:06:31 pm</a>
            <p>版权声明：本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    <!-- paginator -->
    <ul class="post-paginator">
        <li class="next">
                <div class="nextSlogan">Next Post</div>
                <a href="/2024/08/11/Lee-ML-L4/" title="李宏毅机器学习L3 · Sequence as input">
                    <div class="nextTitle">李宏毅机器学习L3 · Sequence as input</div>
                </a>
        </li>
        <li class="previous">
                <div class="prevSlogan">Previous Post</div>
                <a href="/2024/08/05/D2l-Part3-ssd/" title="动手学深度学习 · Part3 SSD代码实现">
                    <div class="prevTitle">动手学深度学习 · Part3 SSD代码实现</div>
                </a>
        </li>
    </ul>
    <!-- comment -->
        <div class="post-comment">
            <!-- 来必力 City 版安装代码 -->

            
            
            
            <!-- utteranc评论 -->

            <!-- partial('_partial/comment/changyan') -->
            <!--PC版-->

            
            
            
        </div>
    <!-- timeliness note -->
    <!-- idea from: https://hexo.fluid-dev.com/posts/hexo-injector/#%E6%96%87%E7%AB%A0%E6%97%B6%E6%95%88%E6%80%A7%E6%8F%90%E7%A4%BA -->
    <!-- Mathjax -->
</main>

                <!-- profile -->
            </div>
            <footer class="footer footer-unloaded">
    <!-- social  -->
        <div class="social">
                            <a href="mailto:954436671@qq.com" class="iconfont-archer email" title="email" ></a>
                <a href="//github.com/aoijays" class="iconfont-archer github" target="_blank" title="github"></a>
                <a href="https://www.zhihu.com/people/Chirs2002" class="iconfont-archer zhihu" target="_blank" title="zhihu"></a>
                <a href="https://www.instagram.com/biribiribird/" class="iconfont-archer instagram" target="_blank" title="instagram"></a>
                <a href="https://space.bilibili.com/498088093" class="iconfont-archer bilibili" target="_blank" title="bilibili"></a>

        </div>
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- website approve for Chinese user -->
    <!-- 不蒜子  -->
        <div class="busuanzi-container">
                <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
        </div>
</footer>

        </div>
        <!-- toc -->
            <div class="toc-wrapper toc-wrapper-loding" style=    top:50vh;
>
                <div class="toc-catalog">
                    <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
                </div>
                <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">Langchain入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.1.</span> <span class="toc-text">前置工作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.1.1.</span> <span class="toc-text">API-KEY配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.1.2.</span> <span class="toc-text">API调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.1.3.</span> <span class="toc-text">Promt 简单应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.2.</span> <span class="toc-text">组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.3.</span> <span class="toc-text">Models</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.3.1.</span> <span class="toc-text">LLMs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">流式输出</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.3.2.</span> <span class="toc-text">Chat Models</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.3.3.</span> <span class="toc-text">Embedding models</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.4.</span> <span class="toc-text">Prompts</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.4.1.</span> <span class="toc-text">PromptTemplate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.4.2.</span> <span class="toc-text">FewShotPromptTemplate</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.5.</span> <span class="toc-text">Chains</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.5.1.</span> <span class="toc-text">LLMChain</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.5.2.</span> <span class="toc-text">SimpleSequentialChain</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.5.3.</span> <span class="toc-text">LLMChain（再解释）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.5.4.</span> <span class="toc-text">SimpleSequentialChain（再解释）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.5.5.</span> <span class="toc-text">SequentialChain</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.6.</span> <span class="toc-text">Agents</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.7.</span> <span class="toc-text">Memory</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.7.1.</span> <span class="toc-text">ChatMessageHistory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.7.2.</span> <span class="toc-text">长期记忆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.7.3.</span> <span class="toc-text">ConversationChains</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.8.</span> <span class="toc-text">Indexes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.8.1.</span> <span class="toc-text">TextLoader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.8.2.</span> <span class="toc-text">CharacterTextSplitter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.8.3.</span> <span class="toc-text">向量数据库</span></a></li></ol></li></ol></li></ol>
            </div>
        <!-- sidebar -->
        <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
        <div class="sidebar-panel-archives">
    <!-- 在 ejs 中将 archive 按照时间排序 -->
        
        
        
        
        
        
        
        
        
        
        
        
        
    <div class="total-and-search">
        <div class="total-archive">
        Total : 13
        </div>
        <!-- search  -->
    </div>
    <div class="post-archive">
            <div class="archive-year"> 2024 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">08/11</span>
            <a class="archive-post-title" href="/2024/08/11/Lee-ML-L4/">李宏毅机器学习L3 · Sequence as input</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/11</span>
            <a class="archive-post-title" href="/2024/08/11/langchain-zero/">Langchain入门笔记</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/05</span>
            <a class="archive-post-title" href="/2024/08/05/D2l-Part3-ssd/">动手学深度学习 · Part3 SSD代码实现</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/04</span>
            <a class="archive-post-title" href="/2024/08/04/D2l-Part3/">动手学深度学习 · Part3 计算机视觉</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/28</span>
            <a class="archive-post-title" href="/2024/07/28/D2l-Part2/">动手学深度学习 · Part2 卷积神经网络</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/27</span>
            <a class="archive-post-title" href="/2024/07/27/Lee-ML-L3/">李宏毅机器学习L3 · Image as input</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/25</span>
            <a class="archive-post-title" href="/2024/07/25/Lee-ML-L2/">李宏毅机器学习L2 · What to do if my network fails to train</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/23</span>
            <a class="archive-post-title" href="/2024/07/23/D2l-Part1/">动手学深度学习 · Part1 深度学习基础</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/21</span>
            <a class="archive-post-title" href="/2024/07/21/Pytorch-intro/">Pytorch小土堆 - 笔记</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/13</span>
            <a class="archive-post-title" href="/2024/06/13/MLP-Handwrite-2024-6/">手推神经网络</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/26</span>
            <a class="archive-post-title" href="/2024/05/26/cuda-zero-2024-5/">CUDA编程0基础入门笔记</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/01</span>
            <a class="archive-post-title" href="/2024/05/01/CS231A/">CS231A - 计算机视觉课堂笔记</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/06</span>
            <a class="archive-post-title" href="/2024/01/06/hello-world/">Hello World</a>
        </li>
            </ul>
    </div>
</div>

        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
            <span class="sidebar-tag-name" data-tags="动手学深度学习">
                <span class="iconfont-archer">&#xe606;</span>
                动手学深度学习
            </span>
            <span class="sidebar-tag-name" data-tags="深度学习">
                <span class="iconfont-archer">&#xe606;</span>
                深度学习
            </span>
            <span class="sidebar-tag-name" data-tags="李宏毅">
                <span class="iconfont-archer">&#xe606;</span>
                李宏毅
            </span>
            <span class="sidebar-tag-name" data-tags="cuda">
                <span class="iconfont-archer">&#xe606;</span>
                cuda
            </span>
            <span class="sidebar-tag-name" data-tags="Pytorch">
                <span class="iconfont-archer">&#xe606;</span>
                Pytorch
            </span>
            <span class="sidebar-tag-name" data-tags="CV">
                <span class="iconfont-archer">&#xe606;</span>
                CV
            </span>
            <span class="sidebar-tag-name" data-tags="langchain">
                <span class="iconfont-archer">&#xe606;</span>
                langchain
            </span>
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
        缺失模块，请参考主题文档进行安装配置：https://github.com/fi3ework/hexo-theme-archer#%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98
    </div> 
    <div class="sidebar-tags-list"></div>
</div>

        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>

    </div>
</div>

        <!-- site-meta -->
        <script>
    var siteMetaRoot = "/"
    if (siteMetaRoot === "undefined") {
        siteMetaRoot = '/'
    }
    var siteMeta = {
        url: "https://aoijays.top",
        root: siteMetaRoot,
        author: "BiribiriBird"
    }
</script>

        <!-- import experimental options here -->
        <!-- Custom Font -->

        <!-- main func -->
        <script src="/scripts/main.js"></script>
        <!-- fancybox -->
        <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.umd.js" onload="window.Fancybox.bind('[data-fancybox]')" defer></script>
        <!-- algolia -->
        <!-- busuanzi -->
            <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
        <!-- async load share.js -->
            <script src="/scripts/share.js" async></script>
        <!-- mermaid -->
    </body>
</html>
